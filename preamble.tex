%=============== Packages ================
% Fonts
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{tgpagella}
\usepackage{mathpazo}

% Math formatting
\usepackage{mathtools}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{thmtools}

% Page formatting, colour and images
\usepackage[inner=2.5cm, outer=1.5cm, top=2.5cm, bottom=2cm]{geometry}
\usepackage{graphicx}
\usepackage{tocloft}
\usepackage[x11names]{xcolor}
\usepackage{wrapfig}
\usepackage{fancyhdr}
\usepackage{emptypage}
\usepackage{imakeidx}
\usepackage{mdframed}
\usepackage{eso-pic}
\usepackage{float}

% Hyperlinks and references
\usepackage[breaklinks]{hyperref}
\usepackage[capitalise, nameinlink]{cleveref}
\usepackage{crossreftools}
\usepackage[
    backend=bibtex,
    style=alphabetic,
    sorting=ynt
]{biblatex}
\usepackage[
    totoc,
    columnsep=20pt,
    hangindent=8pt,
    subindent=20pt,
    subsubindent=30pt
]{idxlayout}
\usepackage[record,symbols,style=alttreegroup,nomain,sort=none]{glossaries-extra}

% Miscellaneous
\usepackage{multicol}
\usepackage{multirow}
\usepackage{enumitem}

%============== Resources ================
\addbibresource{abstract-algebra.bib}

%============= Formatting ================
\linespread{1.05}
\setlength{\parindent}{1.5em}

%============ Redefinitions ==============
\let\oldpart\part
\renewcommand*{\part}[1]{\cleardoubleoddpage\oldpart{#1}\cleardoubleemptypage}
\newcommand{\unnumberedpart}[1]{
    \cleardoubleoddpage
    \addcontentsline{toc}{part}{#1}
    \oldpart*{#1}
    \cleardoubleemptypage
}

% Symbols redefinitions
\let\oldemptyset\emptyset
\let\emptyset\varnothing

\let\totient\varphi

\renewcommand{\vert}{ \ \vline \ }
\newcommand{\vertalt}{ \ | \ }

\newcommand{\myref}[1]{\textbf{\crthypercref{#1}}}
\newcommand{\myreffigures}[1]{\textbf{\cref{#1}}}

\renewcommand{\qedsymbol}{\ensuremath{\blacksquare}}

%=========== Theorem Things ==============
% 'Results' declarations
\newcommand{\makenewresultstyle}[2]{
    \declaretheoremstyle[
        headfont=\normalfont\bfseries,
        bodyfont=\normalfont,
        notefont=\normalfont\bfseries\itshape,
        spaceabove=0pt,  % Space between previous paragraph and current block
        spacebelow=0pt,  % Space between current block and next paragraph
        mdframed={
            skipabove=3pt,  % Space between top of block and beginning of coloured frame
            skipbelow=3pt,  % Space between bottom of block and beginning of coloured frame
            hidealllines=true,
            backgroundcolor=#2,
            usetwoside=false,  % Needed for `leftmargin` and `rightmargin` to work
            leftmargin=-5pt,
            rightmargin=-5pt,
            innerleftmargin=5pt,
            innerrightmargin=5pt
        }
    ]{#1-style}
}

\makenewresultstyle{theorem}{DarkSeaGreen2}
\declaretheorem[name=Theorem,style=theorem-style,within=section]{theorem}
\renewcommand*{\thetheorem}{\arabic{chapter}.\arabic{section}.\arabic{theorem}}

\makenewresultstyle{lemma}{Honeydew2}
\declaretheorem[style=lemma-style,sibling=theorem]{lemma}

\makenewresultstyle{proposition}{Honeydew1}
\declaretheorem[style=proposition-style,sibling=theorem]{proposition}

\makenewresultstyle{corollary}{DarkSeaGreen1}
\declaretheorem[style=corollary-style,sibling=theorem]{corollary}

\makenewresultstyle{definition}{LightCyan1}
\declaretheorem[style=definition-style,sibling=theorem]{definition}

\makenewresultstyle{axiom}{Thistle2}
\declaretheorem[style=axiom-style,sibling=theorem]{axiom}

% 'Questions' declarations
\declaretheoremstyle[
    headfont=\normalfont\bfseries,
    bodyfont=\normalfont,
    spaceabove=5pt,  % Space between previous paragraph and current block
    prefoothook={\vspace{5pt}},
    mdframed={
        skipabove=10pt,  % Space between top of block and beginning of frame
        skipbelow=10pt,  % Space between bottom of block and beginning of frame
        usetwoside=false,
        innerleftmargin=10pt,
        innerrightmargin=10pt
    }
]{exercise-style}
\declaretheorem[style=exercise-style,within=chapter]{exercise}
\renewcommand*{\theexercise}{\arabic{chapter}.\arabic{exercise}}

\declaretheoremstyle[
    headfont=\normalfont\bfseries,
    bodyfont=\normalfont,
    notefont=\normalfont\bfseries\itshape,
    spaceabove=10pt,  % Space between previous paragraph and current block
    spacebelow=10pt,  % Space between current block and next paragraph
]{problem-style}
\declaretheorem[name=Problem,style=problem-style,within=chapter]{problem}
\renewcommand*{\theproblem}{\arabic{chapter}.\arabic{problem}}

% Miscellaneous declarations
\declaretheoremstyle[
    headfont=\normalfont\bfseries,
    bodyfont=\normalfont,
    spaceabove=10pt,  % Space between previous paragraph and current block
    spacebelow=10pt,  % Space between current block and next paragraph
]{general-style}
\declaretheorem[style=general-style,sibling=theorem]{example}
\declaretheorem[style=general-style,numbered=no]{remark}

%============ Environments ===============
\newenvironment{questions}
{\begin{enumerate}[label=\textbf{\arabic*.}]}
{\end{enumerate}}

\newenvironment{partquestions}[1]
{\begin{enumerate}[label=\textbf{(#1)}]}
{\end{enumerate}}

\newcommand{\quoteattr}[3]{
    \vspace{0.5cm}
    \begin{center}
        \parbox{8cm}{
            {\itshape#1}\\
            \null\hfill--- #2\\
            \vspace{-0.1cm}
            \hfill\small(#3)
        }
    \end{center}
    \vspace{0.5cm}
}

%=========== Custom Commands =============
% Miscellaneous commands
\newcommand{\ZeroRoman}[1]{\ifcase\value{#1}\relax0\else\Roman{#1}\fi}  % Roman numeral that works with zero
\newcommand{\code}[1]{\texttt{#1}}  % Code block

% General symbols
\newcommand{\lcm}{\mathrm{lcm}}  % Lowest common multiple function
\newcommand{\sgn}{\mathrm{sgn}}  % Signum function

\newcommand{\im}{\mathrm{im}\;}  % Image of a function
\newcommand{\id}{\mathrm{id}}    % Identity function

% Part 1
\newcommand{\An}[1]{\mathrm{A}_{#1}}                  % Alternating group of degree n
\newcommand{\Aut}[1]{\mathrm{Aut}(#1)}                % Group of automorphisms of G
\newcommand{\Centralizer}[2]{\mathrm{C}_{#1}(#2)}     % Centralizer of an element in G
\newcommand{\Cl}[1]{\mathrm{Cl}(#1)}                  % Conjugacy class of the element x
\newcommand{\Cn}[1]{\mathrm{C}_{#1}}                  % Cyclic group of order n
\newcommand{\GL}[2]{\mathrm{GL}_{#1}\left(#2\right)}  % General Linear Group of degree n
\newcommand{\Inn}[1]{\mathrm{Inn}(#1)}                % Group of inner automorphisms of G
\newcommand{\N}[2]{\mathrm{N}_{#1}(#2)}               % Normalizer of S in G
\newcommand{\Out}[1]{\mathrm{Out}(#1)}                % Group of outer automorphisms of G
\newcommand{\SL}[2]{\mathrm{SL}_{#1}\left(#2\right)}  % Special Linear Group of degree n
\newcommand{\Sn}[1]{\mathrm{S}_{#1}}                  % Symmetric group of degree n
\newcommand{\Syl}[2]{\mathrm{Syl}_{#1}(#2)}           % Set of Sylow p-groups of G
\newcommand{\Sym}[1]{\mathrm{Sym}(#1)}                % Symmetric group of a set
\newcommand{\Un}[1]{\mathcal{U}_{#1}}                 % Group of units modulo n
\newcommand{\CenterGrp}[1]{\mathrm{Z}(#1)}            % Center of a group G

\newcommand{\Stab}[2]{\mathrm{Stab}_{#1}(#2)}         % Stabilizer of x by G
\newcommand{\Fix}[2]{\mathrm{Fix}_{#1}(#2)}           % Set of all elements in X which is fixed by g
\newcommand{\Orb}[2]{\mathrm{Orb}_{#1}(#2)}           % Orbit of x under G

% Part 2
\newcommand{\ideal}[1]{\mathfrak{#1}}                % Ideal of a ring
\newcommand{\princ}[1]{\left\langle#1\right\rangle}  % Principal ideal generated by the element

\newcommand{\Z}{\mathbb{Z}}                        % The ring of integers
\newcommand{\Q}{\mathbb{Q}}                        % The ring of rational numbers
\newcommand{\R}{\mathbb{R}}                        % The ring of real numbers
\newcommand{\C}{\mathbb{C}}                        % The ring of complex numbers

\newcommand{\Mn}[2]{\mathcal{M}_{#1\times#1}(#2)}  % The ring of n by n matrices with entries in the ring R
\newcommand{\ZeroM}[1]{\textbf{0}_{#1}}      % Zero matrix
\newcommand{\IdentityM}[1]{\textbf{I}_{#1}}  % Identity matrix

% \renewcommand{\H}{\mathbb{H}}   % Quaternion Ring
% \newcommand{\qi}{\textbf{i}}    % Quaternion i
% \newcommand{\qj}{\textbf{j}}    % Quaternion j
% \newcommand{\qk}{\textbf{k}}    % Quaternion k

\newcommand{\Ann}[2]{\mathrm{Ann}_{#1}(#2)}  % Annihilator of a subset A of a ring R
\newcommand{\Char}[1]{\mathrm{char}(#1)}     % Characteristic of a ring R
\newcommand{\Nilr}[1]{\mathfrak{N}_{#1}}     % Nilradical of a ring R

%======== Custom Chapter Styling =========
% Fix part numbering
\renewcommand*{\thepart}{\ZeroRoman{part}}

\makeatletter
% Set chapter page format
\renewcommand{\chaptermark}[1]{
    \markboth{\if@mainmatter\chapapp~\thechapter.\ \fi#1}{}
}

\renewcommand*{\chapterformat}{
    \MakeUppercase{\chapapp\nobreakspace\thechapter}
}

\renewcommand*{\chapterlineswithprefixformat}[3]{
    \Ifstr{#1}{chapter}{
        \vspace{-60px}
        \Ifstr{#2}{\empty}{\vspace{40px}}{\raggedleft#2}
        \vspace{-15px}
        \rule{\linewidth}{1pt}\par\nobreak
        \centering{#3}
        \vspace{-10px}
        \rule{\linewidth}{1pt}\par\nobreak
        \vspace{-10px}
    }{#2#3}
}

% Set part page format
\renewcommand*{\partformat}{
    {\fontsize{28pt}{0pt}\selectfont \MakeUppercase{\partname\nobreakspace\thepart}}
}

\renewcommand*{\partlineswithprefixformat}[3]{
    \Ifstr{#1}{part}{
        \Ifstr{#2}{}{  % Doesn't have a part title
            \begin{mdframed}[linewidth=2pt]
                \centering#3
            \end{mdframed}
        }{
            \vspace{-250px}
            \begin{mdframed}[linewidth=2pt]
                \begin{center}
                    \vspace{5px}
                    #2
                    \vspace{-25px}
                    #3
                \end{center}
            \end{mdframed}
        }
    }{#2#3}
}

\makeatother

%======== Figure Caption Format ==========
\usepackage[labelfont=bf]{caption}
\DeclareCaptionLabelFormat{custom}{#1 \ZeroRoman{part}.#2.}
\captionsetup{labelformat=custom,labelsep=space}

%============ Custom Header ==============
\fancypagestyle{plain}{\fancyhf{}\renewcommand{\headrulewidth}{0pt}}  % To clear page numbers from footer, and header line at the start of every chapter

\pagestyle{fancy}
\fancyhf{}  % Clear header/footer

\fancyhead[LE,RO]{\thepage}
\fancyhead[LO,RE]{\textit{\nouppercase\leftmark}}

%====== Customise Table of Contents ======
% Customise part styling in table of contents
\newlength\parttoclen
\renewcommand\cftpartpresnum{Part~}
\settowidth\parttoclen{\bfseries\cftpartpresnum\cftpartaftersnum}
\addtolength\cftpartnumwidth{\parttoclen+1em}  % +1em to make it nicer and more spaced out

% Heading customisation
\makeatletter
\def\createtoc{
    \renewcommand\tableofcontents{
        \chapter*{\contentsname}
        \@starttoc{toc}
    }
    \tableofcontents
}
\makeatother

%======= Customise Draft Watermark =======
\newcommand{\setasdraft}{
    \usepackage{draftwatermark}
    \SetWatermarkLightness{0.95}
    \SetWatermarkScale{1}
}

%============= Index Pages ===============
\makeindex[options= -s index-style.ist]

%======= Bibliography Formatting =========
% These two lines are here to ensure that URLs do not exceed the page by too much
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}
